<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
  <mapper namespace="winwin.dao.JobopenDao">
  
  	<insert id="insertBasic" parameterType="winwin.dto.JobopenBasic">
  		<selectKey order="BEFORE" keyProperty="jobopenNo" resultType="int">
  			select JobOpenBasic_seq.nextval from dual
  		</selectKey>
  		insert into jobopenBasic(jobopenNo, title, offer, form, startPay, endPay, rulePay, startDate, endDate, allOpen, display)
  		values(#{jobopenNo}, #{title}, #{offer}, #{form}, #{startPay}, #{endPay}, #{rulePay},
  		<if test="startDate!=null">
  		#{startDate}, 
  		</if> 
  		<if test="startDate==null">
  		null, 
  		</if> 
 		<if test="endDate!=null">
  		#{endDate}, 
  		</if> 
  		<if test="endDate==null">
  		null, 
  		</if> 
   		 #{allOpen}, 0)
  	</insert>
  	
  	<select id="selectBasic" resultType="winwin.dto.JobopenBasic" parameterType="winwin.util.Paging">
  		SELECT * FROM ( 
            SELECT rownum rnum, B.* FROM (
		         SELECT * FROM jobopenbasic
                ORDER BY jobopenno DESC 
            ) B 
        ) R WHERE R.rnum BETWEEN #{startNo} AND #{endNo } ORDER BY rnum 	
  	</select>
  	
	<select id="CountBasic" resultType="int">
		SELECT COUNT(*) CNT FROM (
		 SELECT * FROM jobopenbasic
		) CNT
	</select>
	
	<insert id="insertDetail" parameterType="winwin.dto.JobopenDetail">
		insert into jobopenDetail(jobopenNo, sector, task, volume, location, special, title, display)
		values(#{jobopenNo}, #{sector}, #{task}, #{volume}, #{location}, #{special}, #{title}, 0)
	
	</insert>
	
	<update id="updateBasic" parameterType="winwin.dto.JobopenBasic">
		update jobopenBasic set academic=#{academic}, score=#{score}, lang=#{lang}, etcQual=#{etcQual}, etc=#{etc} where jobopenNo=#{jobopenNo} 
	</update>
	
	<select id="selectByBasic" resultType="winwin.dto.JobopenBasic" parameterType="winwin.dto.JobopenBasic">
		select * from jobopenBasic where jobopenNo = #{jobopenNo}
	</select>
	
	<select id="selectDetail" parameterType="winwin.dto.JobopenDetail" resultType="winwin.dto.JobopenDetail">
		select * from jobopenDetail where jobopenNo = #{jobopenNo}
	</select>
	
	<delete id="deleteBasic" parameterType="int">
		delete from jobopenBasic where jobopenNo = #{jobopenNo}
	</delete>
	
	<delete id="deleteDetail" parameterType="int">
		delete from jobopenDetail where jobopenNo = #{jobopenNo}
	</delete>
	
	<update id="resetBasic" parameterType="winwin.dto.JobopenBasic">
		update jobopenBasic set title=#{title}, offer=#{offer}, form=#{form}, startPay=#{startPay}, endPay=#{endPay}, rulePay=#{rulePay}, startDate=#{startDate}, endDate=#{endDate}, allOpen=#{allOpen} where jobopenNo=#{jobopenNo}
	</update>
	
	<update id="updateHit" parameterType="winwin.dto.JobopenBasic">
		update jobopenBasic set hit=hit+1
		WHERE jobopenNo = #{jobopenNo}
	</update>
	
	<update id="updateBasicDis" parameterType="int">
		update jobopenBasic set display=1 where jobopenNo = #{jobopenNo}
	</update>
	
	<update id="updateDetailDis" parameterType="int">
		update jobopenDetail set display=1 where jobopenNo = #{jobopenNo}
	</update>
	
  
  </mapper>